# API Пользователей

## Описание
Модуль для работы с пользователями системы. Включает в себя регистрацию с паролем, авторизацию, работу с refresh токенами и CRUD операции.

## Эндпоинты

### 1. Регистрация пользователя
- **POST** `/user/register`
- **Описание**: Создание нового пользователя с паролем
- **Тело запроса**:
```json
{
  "login": "ivan_ivanov",
  "password": "password123",
  "fullName": "Иван Иванов",
  "email": "ivan@example.com",
  "avatarUrl": "https://example.com/avatar.jpg",
  "bio": "Разработчик из Москвы"
}
```
- **Ответ**: `{ accessToken, refreshToken, user }`

### 2. Авторизация пользователя
- **POST** `/user/login`
- **Описание**: Вход пользователя с паролем
- **Тело запроса**:
```json
{
  "login": "ivan_ivanov",
  "password": "password123",
  "deviceInfo": "Chrome 120.0.0.0 Windows 10"
}
```
- **Ответ**: `{ accessToken, refreshToken, user }`

### 3. Обновление токенов
- **POST** `/user/refresh`
- **Описание**: Обновление access token с помощью refresh token
- **Тело запроса**:
```json
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```
- **Ответ**: `{ accessToken, refreshToken }`

### 4. Отзыв токена
- **POST** `/user/revoke`
- **Описание**: Отзыв конкретного refresh token
- **Тело запроса**:
```json
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```
- **Ответ**: `{ message: "Токен успешно отозван" }`

### 5. Отзыв всех токенов пользователя
- **DELETE** `/user/tokens/:userId`
- **Описание**: Отзыв всех refresh токенов пользователя
- **Параметры**: `userId` - ID пользователя
- **Ответ**: `{ message: "Все токены пользователя отозваны" }`

### 6. Получение токенов пользователя
- **GET** `/user/tokens/:userId`
- **Описание**: Получение списка всех refresh токенов пользователя
- **Параметры**: `userId` - ID пользователя
- **Ответ**: `RefreshTokens[]`

### 7. Получение списка пользователей
- **GET** `/user?page=1&limit=10`
- **Описание**: Получение списка пользователей с пагинацией
- **Параметры**: 
  - `page` - номер страницы (по умолчанию: 1)
  - `limit` - количество элементов на странице (по умолчанию: 10)
- **Ответ**: `{ users, total, page, limit, totalPages }`

### 8. Получение пользователя по ID
- **GET** `/user/:id`
- **Описание**: Получение информации о конкретном пользователе
- **Параметры**: `id` - ID пользователя
- **Ответ**: `UsersDto`

### 9. Обновление пользователя
- **PUT** `/user/:id`
- **Описание**: Обновление данных пользователя
- **Параметры**: `id` - ID пользователя
- **Тело запроса**:
```json
{
  "login": "new_login",
  "fullName": "Новое имя",
  "email": "new@example.com",
  "avatarUrl": "https://example.com/new-avatar.jpg",
  "bio": "Новая биография",
  "dateOfBirth": "1990-01-01",
  "isEmailVerified": true
}
```
- **Ответ**: `UsersDto`

### 10. Удаление пользователя
- **DELETE** `/user/:id`
- **Описание**: Удаление пользователя
- **Параметры**: `id` - ID пользователя
- **Ответ**: `{ message: "Пользователь успешно удален" }`

## Коды ответов

- **200** - Успешный запрос
- **201** - Пользователь создан
- **400** - Некорректные данные
- **401** - Неверные учетные данные / Недействительный токен
- **404** - Пользователь не найден
- **409** - Пользователь уже существует
- **500** - Ошибка сервера

## Модель данных

### UsersDto
```typescript
{
  id: number;              // Уникальный идентификатор
  login: string;           // Логин пользователя
  fullName?: string;       // Полное имя
  email?: string;          // Email
  avatarUrl?: string;      // Ссылка на аватар
  bio?: string;            // Биография
  dateOfBirth?: Date;      // Дата рождения
  isEmailVerified?: boolean; // Подтвержден ли email
  createdAt: Date;         // Дата создания
  updatedAt: Date;         // Дата обновления
  lastLoginAt?: Date;      // Дата последнего входа
}
```

### RefreshTokens
```typescript
{
  id: number;              // Уникальный идентификатор
  token: string;           // Refresh token
  expiresAt: Date;         // Дата истечения
  userId: number;          // ID пользователя
  deviceInfo?: string;     // Информация об устройстве
  createdAt: Date;         // Дата создания
  updatedAt: Date;         // Дата обновления
}
```

## Особенности

1. **Регистрация с паролем**: Все пользователи регистрируются с паролем
2. **Хеширование паролей**: пароли хешируются с помощью bcrypt (10 раундов)
3. **Refresh токены**: поддерживается система refresh токенов с автоматическим обновлением
4. **Уникальность логинов**: логины пользователей уникальны
5. **Управление токенами**: возможность отзыва отдельных или всех токенов пользователя
6. **Информация об устройствах**: сохраняется информация об устройстве для каждого токена
7. **Автоматическая очистка**: просроченные токены автоматически удаляются
8. **Валидация данных**: все входные данные валидируются
9. **JWT токены**: access token (15 минут) и refresh token (7 дней)
10. **Безопасность**: при удалении пользователя отзываются все его токены

## Безопасность

- Пароли хешируются с использованием bcrypt
- Refresh токены хранятся в отдельной базе данных
- Токены имеют ограниченный срок действия
- Поддерживается отзыв токенов
- Валидация всех входных данных